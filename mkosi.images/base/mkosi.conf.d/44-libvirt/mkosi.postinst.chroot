#!/usr/bin/sh
set -euf
orig_path=/etc/libvirt
subs_path=/var/lib/libvirt/etc/libvirt

rm -rfv "${orig_path}/nwfilter/"*
if [ -d "${orig_path}" ]; then
  mkdir -pv "/usr/share/factory/${subs_path%/*}"
  mv -v "${orig_path}" "/usr/share/factory/${subs_path%/*}"
  ln -svnf "${subs_path}" "${orig_path}"
fi

if [ -e '/etc/selinux/config' ]; then
  . '/etc/selinux/config'
  if [ "${SELINUX:-disabled}" != 'disabled' ]; then
    semanage fcontext -a -e '/etc' '/var/lib/libvirt/etc'
  fi
fi
